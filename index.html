<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>蛋鸡生产日报工具</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" />
  <style>
    body { font-family: Arial, sans-serif; background-color: #F5F5F5; color: #333; padding: 1rem; margin: 0; }
    .container { max-width: 100%; margin: auto; }
    .card { background-color: #FFF; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); padding: 1rem; margin-bottom: 1rem; }
    .card h2 { color: #4CAF50; margin-top: 0; font-size: 1.2rem; }
    .card h3 { color: #2196F3; font-size: 1.1rem; }
    table { width: 100%; border-collapse: collapse; font-size: 0.9rem; }
    th, td { padding: 6px; text-align: left; border: 1px solid #E0E0E0; }
    th { color: #2196F3; font-weight: 600; }
    input { width: 100%; padding: 5px; border: 1px solid #E0E0E0; border-radius: 4px; box-sizing: border-box; }
    input[readonly] { background-color: #F5F5F5; }
    button { background-color: #4CAF50; color: #FFF; border: none; padding: 8px 12px; border-radius: 4px; cursor: pointer; }
    .time-range { display: flex; align-items: center; gap: 0.5rem; }
    .time-range input { width: 45%; }
    .add-row-btn { background-color: #2196F3; margin-top: 0.5rem; }
    .remove-row-btn { background-color: #D32F2F; margin-left: 0.5rem; }
    @media (max-width: 600px) { 
      .card { padding: 0.8rem; } 
      table { font-size: 0.8rem; } 
      input { font-size: 0.8rem; } 
      button { padding: 6px 10px; } 
    }
  </style>
</head>
<body>
<div class="container">
  <div class="card" id="input">
    <h2><i class="fas fa-keyboard"></i> 数据输入</h2>
    <table>
      <tr><th>日期</th><td><input type="date" id="date" oninput="calculate()"></td>
          <th>昨日存栏</th><td><input type="number" id="stockYesterday" min="0" oninput="calculate()"></td></tr>
      <tr><th>死淘</th><td><input type="number" id="deadCount" min="0" oninput="calculate()"></td>
          <th>今日存栏</th><td><input type="number" id="stockToday" readonly></td></tr>
      <tr><th>收蛋时间</th><td colspan="3">
            <div class="time-range">
              <input type="time" id="collectTimeStart" oninput="calculate()">
              <span>-</span>
              <input type="time" id="collectTimeEnd" oninput="calculate()">
            </div>
          </td></tr>
      <tr><th>产蛋个数</th><td><input type="number" id="eggCount" min="0" oninput="calculate()"></td>
          <th>产蛋斤数（斤）</th><td><input type="number" id="eggWeight" min="0" oninput="calculate()"></td></tr>
    </table>
    <h3>料板块</h3>
    <table id="feedTable">
      <tr><th>昨日料表（kg）</th><td><input type="number" class="feedMeterPrev" min="0" oninput="calculate()"></td>
          <th>标签</th><td><input type="text" class="feedMeterPrevLabel" value="VK116/1069/4.26"></td>
          <td><button class="remove-row-btn" onclick="removeRow(this)">-</button></td></tr>
      <tr><th>进料数（kg）</th><td><input type="number" class="feedIn" min="0" oninput="calculate()"></td>
          <th>标签</th><td><input type="text" class="feedInLabel" value="VK116/1069/4.26"></td>
          <td><button class="remove-row-btn" onclick="removeRow(this)">-</button></td></tr>
      <tr><th>今日料表（kg）</th><td><input type="number" class="feedMeterToday" min="0" oninput="calculate()"></td>
          <th>标签</th><td><input type="text" class="feedMeterTodayLabel" value="VK116/1069/4.26"></td>
          <td><button class="remove-row-btn" onclick="removeRow(this)">-</button></td></tr>
    </table>
    <button class="add-row-btn" onclick="addFeedRow('昨日料表')">+ 昨日料表</button>
    <button class="add-row-btn" onclick="addFeedRow('进料数')">+ 进料数</button>
    <button class="add-row-btn" onclick="addFeedRow('今日料表')">+ 今日料表</button>
  </div>

  <div class="card" id="results">
    <h2><i class="fas fa-chart-bar"></i> 实时分析</h2>
    <table>
      <tr><th>日总采食（kg）</th><td><input type="number" id="totalFeed" readonly></td>
          <th>日均采食（g）</th><td><input type="number" id="avgFeed" readonly></td></tr>
      <tr><th>产蛋率（%）</th><td><input type="number" id="layRate" readonly></td>
          <th>只均产蛋量（g）</th><td><input type="number" id="eggPerHen" readonly></td></tr>
    </table>
  </div>

  <div class="card" id="report">
    <h2><i class="fas fa-file-alt"></i> 日报输出</h2>
    <button onclick="generateReport()">生成日报</button>
    <textarea id="reportText" readonly rows="10"></textarea>
  </div>
</div>

<script>
function $(id) { return document.getElementById(id); }

// 添加新的料板块行
function addFeedRow(type) {
  const table = $('feedTable');
  const row = document.createElement('tr');
  row.innerHTML = `
    <th>${type}（kg）</th>
    <td><input type="number" class="${type === '昨日料表' ? 'feedMeterPrev' : type === '进料数' ? 'feedIn' : 'feedMeterToday'}" min="0" oninput="calculate()"></td>
    <th>标签</th>
    <td><input type="text" class="${type === '昨日料表' ? 'feedMeterPrevLabel' : type === '进料数' ? 'feedInLabel' : 'feedMeterTodayLabel'}" value="VK116/1069/4.26"></td>
    <td><button class="remove-row-btn" onclick="removeRow(this)">-</button></td>
  `;
  table.appendChild(row);
}

// 删除行
function removeRow(btn) {
  const row = btn.parentNode.parentNode;
  row.parentNode.removeChild(row);
  calculate();
}

// 计算逻辑
function calculate() {
  const stockYesterday = parseFloat($('stockYesterday').value) || 0;
  const deadCount = parseFloat($('deadCount').value) || 0;
  const stockToday = stockYesterday - deadCount;
  $('stockToday').value = stockToday >= 0 ? stockToday : 0;

  const feedMeterPrevInputs = document.querySelectorAll('.feedMeterPrev');
  const feedInInputs = document.querySelectorAll('.feedIn');
  const feedMeterTodayInputs = document.querySelectorAll('.feedMeterToday');

  let totalFeedMeterPrev = 0;
  feedMeterPrevInputs.forEach(input => totalFeedMeterPrev += parseFloat(input.value) || 0);

  let totalFeedIn = 0;
  feedInInputs.forEach(input => totalFeedIn += parseFloat(input.value) || 0);

  let totalFeedMeterToday = 0;
  feedMeterTodayInputs.forEach(input => totalFeedMeterToday += parseFloat(input.value) || 0);

  const totalFeed = totalFeedMeterPrev + totalFeedIn - totalFeedMeterToday;
  const avgFeed = stockToday ? (totalFeed / stockToday * 1000).toFixed(1) : 0;

  const eggCount = parseFloat($('eggCount').value) || 0;
  const eggWeight = parseFloat($('eggWeight').value) || 0;
  const layRate = stockToday ? (eggCount / stockToday * 100).toFixed(1) : 0;
  const eggPerHen = stockToday ? (eggWeight / stockToday * 1000).toFixed(1) : 0;

  $('totalFeed').value = totalFeed.toFixed(1);
  $('avgFeed').value = avgFeed;
  $('layRate').value = layRate;
  $('eggPerHen').value = eggPerHen;
}

// 生成日报
function generateReport() {
  const date = new Date($('date').value);
  const dateStr = `${date.getMonth() + 1}月${date.getDate()}日`;
  const stockToday = parseFloat($('stockToday').value) || 0;
  const collectTime = `${$('collectTimeStart').value}-${$('collectTimeEnd').value}` || '未知';
  const eggCount = parseFloat($('eggCount').value) || 0;
  const eggWeight = parseFloat($('eggWeight').value) || 0;
  const totalFeed = parseFloat($('totalFeed').value) || 0;
  const avgFeed = parseFloat($('avgFeed').value) || 0;
  const layRate = parseFloat($('layRate').value) || 0;
  const eggPerHen = parseFloat($('eggPerHen').value) || 0;

  const feedMeterPrevData = Array.from(document.querySelectorAll('.feedMeterPrev')).map((input, i) => {
    const label = document.querySelectorAll('.feedMeterPrevLabel')[i].value;
    return `${parseFloat(input.value || 0).toFixed(1)} (${label})`;
  }).join(', ');
  const feedInData = Array.from(document.querySelectorAll('.feedIn')).map((input, i) => {
    const label = document.querySelectorAll('.feedInLabel')[i].value;
    return `${parseFloat(input.value || 0).toFixed(1)} (${label})`;
  }).join(', ');
  const feedMeterTodayData = Array.from(document.querySelectorAll('.feedMeterToday')).map((input, i) => {
    const label = document.querySelectorAll('.feedMeterTodayLabel')[i].value;
    return `${parseFloat(input.value || 0).toFixed(1)} (${label})`;
  }).join(', ');

  const report = `蛋鸡生产日报
日期：${dateStr}
存栏：${stockToday}
昨日料表（kg）：${feedMeterPrevData || '0'}
进料数（kg）：${feedInData || '0'}
今日料表（kg）：${feedMeterTodayData || '0'}
收蛋时间：${collectTime}
产蛋个数：${eggCount}
产蛋斤数（斤）：${eggWeight.toFixed(1)}
日总采食（kg）：${totalFeed.toFixed(1)}
日均采食（g）：${avgFeed}
产蛋率（%）：${layRate}
只均产蛋量（g）：${eggPerHen}`.trim();

  $('reportText').value = report;
}

// 初始化
calculate();
</script>
</body>
</html>
